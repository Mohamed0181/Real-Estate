<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#3B82F6">
    <title>ุฅุฏุงุฑุฉ ุงูุฏููู</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        * {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <!-- React & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function DebtTrackerApp() {
            const [currentScreen, setCurrentScreen] = useState('login');
            const [showPassword, setShowPassword] = useState(false);
            const [isLogin, setIsLogin] = useState(true);
            
            // Auth States
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [currentUser, setCurrentUser] = useState(null);
            
            // Transaction States
            const [transactions, setTransactions] = useState([]);
            const [showAddModal, setShowAddModal] = useState(false);
            const [formData, setFormData] = useState({
                type: 'receivable',
                name: '',
                amount: '',
                notes: '',
                date: new Date().toISOString().split('T')[0]
            });

            // Load data from localStorage on mount
            useEffect(() => {
                const savedUser = localStorage.getItem('currentUser');
                if (savedUser) {
                    const user = JSON.parse(savedUser);
                    setCurrentUser(user);
                    loadUserTransactions(user.email);
                    setCurrentScreen('home');
                }
            }, []);

            // Load user transactions
            const loadUserTransactions = (email) => {
                const saved = localStorage.getItem(`transactions_${email}`);
                if (saved) {
                    setTransactions(JSON.parse(saved));
                }
            };

            // Save transactions
            const saveTransactions = (email, trans) => {
                localStorage.setItem(`transactions_${email}`, JSON.stringify(trans));
            };

            // Auth Functions
            const handleLogin = () => {
                if (!email || !password) {
                    alert('ูู ูุถูู ุฃุฏุฎู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููููุฉ ุงููุฑูุฑ');
                    return;
                }

                const userKey = `user_${email}`;
                
                if (isLogin) {
                    const savedUser = localStorage.getItem(userKey);
                    if (savedUser) {
                        const userData = JSON.parse(savedUser);
                        if (userData.password === password) {
                            const user = { email, name: userData.name };
                            setCurrentUser(user);
                            localStorage.setItem('currentUser', JSON.stringify(user));
                            loadUserTransactions(email);
                            setCurrentScreen('home');
                            alert('ุฃููุงู ุจูู! ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ ๐');
                        } else {
                            alert('ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ โ');
                        }
                    } else {
                        alert('ุงููุณุชุฎุฏู ุบูุฑ ููุฌูุฏ. ุณุฌู ุญุณุงุจ ุฌุฏูุฏ ุงูุฃูู ๐');
                    }
                } else {
                    const existingUser = localStorage.getItem(userKey);
                    if (existingUser) {
                        alert('ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุณุฌู ุจุงููุนู. ุณุฌู ุฏุฎูู ุจุฏูุงู ูู ุฐูู โ');
                    } else {
                        const newUser = {
                            email,
                            password,
                            name: email.split('@')[0]
                        };
                        localStorage.setItem(userKey, JSON.stringify(newUser));
                        const user = { email, name: newUser.name };
                        setCurrentUser(user);
                        localStorage.setItem('currentUser', JSON.stringify(user));
                        setTransactions([]);
                        setCurrentScreen('home');
                        alert('ุชู ุฅูุดุงุก ุงูุญุณุงุจ ุจูุฌุงุญ! ๐');
                    }
                }
            };

            const handleLogout = () => {
                localStorage.removeItem('currentUser');
                setCurrentUser(null);
                setTransactions([]);
                setEmail('');
                setPassword('');
                setCurrentScreen('login');
            };

            // Transaction Functions
            const addTransaction = () => {
                if (!formData.name || !formData.amount) {
                    alert('ูู ูุถูู ุฃุฏุฎู ุงูุงุณู ูุงููุจูุบ');
                    return;
                }

                const newTransaction = {
                    id: Date.now(),
                    ...formData,
                    amount: parseFloat(formData.amount),
                    paid: false,
                    createdAt: new Date().toISOString()
                };

                const updatedTransactions = [...transactions, newTransaction];
                setTransactions(updatedTransactions);
                saveTransactions(currentUser.email, updatedTransactions);

                setFormData({
                    type: 'receivable',
                    name: '',
                    amount: '',
                    notes: '',
                    date: new Date().toISOString().split('T')[0]
                });
                setShowAddModal(false);
                alert('ุชูุช ุงูุฅุถุงูุฉ ุจูุฌุงุญ! โ');
            };

            const deleteTransaction = (id) => {
                if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงููุนุงููุฉุ')) {
                    const updatedTransactions = transactions.filter(t => t.id !== id);
                    setTransactions(updatedTransactions);
                    saveTransactions(currentUser.email, updatedTransactions);
                }
            };

            const togglePaid = (id) => {
                const updatedTransactions = transactions.map(t =>
                    t.id === id ? { ...t, paid: !t.paid } : t
                );
                setTransactions(updatedTransactions);
                saveTransactions(currentUser.email, updatedTransactions);
            };

            // Calculations
            const totalReceivable = transactions
                .filter(t => t.type === 'receivable' && !t.paid)
                .reduce((sum, t) => sum + t.amount, 0);

            const totalPayable = transactions
                .filter(t => t.type === 'payable' && !t.paid)
                .reduce((sum, t) => sum + t.amount, 0);

            const netBalance = totalReceivable - totalPayable;

            // Login Screen
            if (currentScreen === 'login') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-500 via-blue-600 to-purple-600 flex items-center justify-center p-4">
                        <div className="w-full max-w-md">
                            <div className="text-center mb-8">
                                <div className="inline-flex items-center justify-center w-20 h-20 bg-white rounded-full shadow-lg mb-4">
                                    <i data-lucide="wallet" className="w-10 h-10 text-blue-600"></i>
                                </div>
                                <h1 className="text-3xl font-bold text-white mb-2">ุฅุฏุงุฑุฉ ุงูุฏููู</h1>
                                <p className="text-blue-100">ุณุฌู ูููุณู ุจุณูููุฉ ูุฃูุงู</p>
                            </div>

                            <div className="bg-white rounded-2xl shadow-2xl p-8">
                                <div className="mb-6">
                                    <h2 className="text-2xl font-bold text-gray-800 text-center mb-2">
                                        {isLogin ? 'ุชุณุฌูู ุงูุฏุฎูู' : 'ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ'}
                                    </h2>
                                    <p className="text-gray-600 text-center text-sm">
                                        {isLogin ? 'ุฃููุงู ุจุนูุฏุชู!' : 'ุงูุถู ููุง ุงูุขู'}
                                    </p>
                                </div>

                                <div className="space-y-5">
                                    <div>
                                        <label className="block text-gray-700 text-sm font-semibold mb-2 text-right">
                                            ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
                                        </label>
                                        <input
                                            type="email"
                                            value={email}
                                            onChange={(e) => setEmail(e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-right"
                                            placeholder="example@email.com"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-gray-700 text-sm font-semibold mb-2 text-right">
                                            ูููุฉ ุงููุฑูุฑ
                                        </label>
                                        <div className="relative">
                                            <input
                                                type={showPassword ? 'text' : 'password'}
                                                value={password}
                                                onChange={(e) => setPassword(e.target.value)}
                                                onKeyDown={(e) => e.key === 'Enter' && handleLogin()}
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-right"
                                                placeholder="โขโขโขโขโขโขโขโข"
                                            />
                                            <button
                                                type="button"
                                                onClick={() => setShowPassword(!showPassword)}
                                                className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 cursor-pointer"
                                            >
                                                <i data-lucide={showPassword ? 'eye-off' : 'eye'} className="w-5 h-5"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <button
                                        type="button"
                                        onClick={handleLogin}
                                        className="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-lg font-bold shadow-lg hover:from-blue-600 hover:to-blue-700 active:scale-95 transition-transform cursor-pointer"
                                    >
                                        {isLogin ? 'ุฏุฎูู' : 'ุฅูุดุงุก ุญุณุงุจ'}
                                    </button>
                                </div>

                                <div className="mt-6 text-center">
                                    <p className="text-gray-600 text-sm">
                                        {isLogin ? 'ูุง ุนูุฏูุด ุญุณุงุจุ' : 'ุนูุฏู ุญุณุงุจ ุจุงููุนูุ'}
                                        <span
                                            onClick={() => setIsLogin(!isLogin)}
                                            className="text-blue-600 font-bold mr-2 cursor-pointer hover:underline"
                                        >
                                            {isLogin ? 'ุณุฌู ุงูุขู' : 'ุณุฌู ุฏุฎูู'}
                                        </span>
                                    </p>
                                </div>
                            </div>

                            <p className="text-center text-white text-sm mt-6 opacity-75">
                                ๐พ ุงูุจูุงูุงุช ูุญููุธุฉ ุจุดูู ุฏุงุฆู
                            </p>
                        </div>
                    </div>
                );
            }

            // Main App Screen
            return (
                <div className="min-h-screen bg-gray-50">
                    <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 shadow-lg">
                        <div className="max-w-4xl mx-auto flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <i data-lucide="wallet" className="w-8 h-8"></i>
                                <div>
                                    <h1 className="text-xl font-bold">ุฅุฏุงุฑุฉ ุงูุฏููู</h1>
                                    <p className="text-sm text-blue-100">ูุฑุญุจุงู {currentUser?.name}</p>
                                </div>
                            </div>
                            <button
                                onClick={handleLogout}
                                className="p-2 hover:bg-white/20 rounded-lg transition cursor-pointer"
                            >
                                <i data-lucide="log-out" className="w-6 h-6"></i>
                            </button>
                        </div>
                    </div>

                    <div className="max-w-4xl mx-auto p-4 space-y-4">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div className="bg-green-500 text-white rounded-xl p-6 shadow-lg">
                                <div className="flex items-center justify-between mb-2">
                                    <i data-lucide="trending-up" className="w-6 h-6"></i>
                                    <span className="text-sm font-semibold">ููู</span>
                                </div>
                                <p className="text-3xl font-bold">{totalReceivable.toFixed(2)} ุฌ.ู</p>
                                <p className="text-sm text-green-100 mt-1">ูุณุชุญูุงุช</p>
                            </div>

                            <div className="bg-red-500 text-white rounded-xl p-6 shadow-lg">
                                <div className="flex items-center justify-between mb-2">
                                    <i data-lucide="trending-down" className="w-6 h-6"></i>
                                    <span className="text-sm font-semibold">ุนููู</span>
                                </div>
                                <p className="text-3xl font-bold">{totalPayable.toFixed(2)} ุฌ.ู</p>
                                <p className="text-sm text-red-100 mt-1">ุฏููู</p>
                            </div>

                            <div className={`${netBalance >= 0 ? 'bg-blue-500' : 'bg-orange-500'} text-white rounded-xl p-6 shadow-lg`}>
                                <div className="flex items-center justify-between mb-2">
                                    <i data-lucide="dollar-sign" className="w-6 h-6"></i>
                                    <span className="text-sm font-semibold">ุงูุตุงูู</span>
                                </div>
                                <p className="text-3xl font-bold">{netBalance.toFixed(2)} ุฌ.ู</p>
                                <p className="text-sm opacity-90 mt-1">ุงูุฑุตูุฏ</p>
                            </div>
                        </div>

                        <button
                            onClick={() => setShowAddModal(true)}
                            className="w-full bg-blue-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:bg-blue-700 active:scale-95 transition-all flex items-center justify-center gap-2 cursor-pointer"
                        >
                            <i data-lucide="plus" className="w-6 h-6"></i>
                            ุฅุถุงูุฉ ูุนุงููุฉ ุฌุฏูุฏุฉ
                        </button>

                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-4 text-right">ุงููุนุงููุงุช</h2>
                            
                            {transactions.length === 0 ? (
                                <div className="text-center py-12">
                                    <i data-lucide="wallet" className="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                                    <p className="text-gray-500 text-lg">ูุง ุชูุฌุฏ ูุนุงููุงุช ุจุนุฏ</p>
                                    <p className="text-gray-400 text-sm mt-2">ุงุถุบุท ุนูู ุงูุฒุฑ ุฃุนูุงู ูุฅุถุงูุฉ ูุนุงููุฉ ุฌุฏูุฏุฉ</p>
                                </div>
                            ) : (
                                <div className="space-y-3">
                                    {transactions.sort((a, b) => b.id - a.id).map((transaction) => (
                                        <div
                                            key={transaction.id}
                                            className={`border-r-4 ${
                                                transaction.type === 'receivable' ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50'
                                            } p-4 rounded-lg ${transaction.paid ? 'opacity-50' : ''}`}
                                        >
                                            <div className="flex justify-between items-start mb-2">
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => togglePaid(transaction.id)}
                                                        className={`p-2 rounded-lg ${
                                                            transaction.paid ? 'bg-gray-400' : 'bg-blue-500'
                                                        } text-white hover:opacity-80 cursor-pointer active:scale-95 transition-transform`}
                                                    >
                                                        <i data-lucide={transaction.paid ? 'x' : 'check'} className="w-4 h-4"></i>
                                                    </button>
                                                    <button
                                                        onClick={() => deleteTransaction(transaction.id)}
                                                        className="p-2 bg-red-500 text-white rounded-lg hover:bg-red-600 cursor-pointer active:scale-95 transition-transform"
                                                    >
                                                        <i data-lucide="trash-2" className="w-4 h-4"></i>
                                                    </button>
                                                </div>
                                                <div className="text-right flex-1">
                                                    <h3 className="font-bold text-gray-800">{transaction.name}</h3>
                                                    <p className="text-sm text-gray-600">{transaction.date}</p>
                                                    {transaction.notes && (
                                                        <p className="text-sm text-gray-500 mt-1">{transaction.notes}</p>
                                                    )}
                                                </div>
                                            </div>
                                            <div className="flex justify-between items-center">
                                                <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
                                                    transaction.paid ? 'bg-gray-200 text-gray-700' : 
                                                    transaction.type === 'receivable' ? 'bg-green-200 text-green-800' : 'bg-red-200 text-red-800'
                                                }`}>
                                                    {transaction.paid ? 'ูุฏููุนุฉ โ' : transaction.type === 'receivable' ? 'ููู' : 'ุนููู'}
                                                </span>
                                                <p className="text-2xl font-bold text-gray-800">
                                                    {transaction.amount.toFixed(2)} ุฌ.ู
                                                </p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>

                    {showAddModal && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-2xl p-6 w-full max-w-md max-h-[90vh] overflow-y-auto">
                                <h2 className="text-2xl font-bold text-gray-800 mb-6 text-right">ูุนุงููุฉ ุฌุฏูุฏุฉ</h2>
                                
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-gray-700 font-semibold mb-2 text-right">ุงูููุน</label>
                                        <div className="grid grid-cols-2 gap-3">
                                            <button
                                                onClick={() => setFormData({...formData, type: 'payable'})}
                                                className={`py-3 rounded-lg font-bold cursor-pointer active:scale-95 transition-transform ${
                                                    formData.type === 'payable' ? 'bg-red-500 text-white' : 'bg-gray-200 text-gray-700'
                                                }`}
                                            >
                                                ุนููู (ุฏูู)
                                            </button>
                                            <button
                                                onClick={() => setFormData({...formData, type: 'receivable'})}
                                                className={`py-3 rounded-lg font-bold cursor-pointer active:scale-95 transition-transform ${
                                                    formData.type === 'receivable' ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-700'
                                                }`}
                                            >
                                                ููู (ูุณุชุญู)
                                            </button>
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-gray-700 font-semibold mb-2 text-right">ุงุณู ุงูุดุฎุต</label>
                                        <input
                                            type="text"
                                            value={formData.name}
                                            onChange={(e) => setFormData({...formData, name: e.target.value})}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-right"
                                            placeholder="ุฃุญูุฏ ูุญูุฏ"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-gray-700 font-semibold mb-2 text-right">ุงููุจูุบ (ุฌ.ู)</label>
                                        <input
                                            type="number"
                                            value={formData.amount}
                                            onChange={(e) => setFormData({...formData, amount: e.target.value})}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-right"
                                            placeholder="0.00"
                                            step="0.01"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-gray-700 font-semibold mb-2 text-right">ุงูุชุงุฑูุฎ</label>
                                        <input
                                            type="date"
                                            value={formData.date}
                                            onChange={(e) => setFormData({...formData, date: e.target.value})}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-right"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-gray-700 font-semibold mb-2 text-right">ููุงุญุธุงุช</label>
                                        <textarea
                                            value={formData.notes}
                                            onChange={(e) => setFormData({...formData, notes: e.target.value})}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none text-right"
                                            placeholder="ููุงุญุธุงุช ุฅุถุงููุฉ (ุงุฎุชูุงุฑู)"
                                            rows="3"
                                        />
                                    </div>

                                    <div className="flex gap-3 mt-6">
                                        <button
                                            onClick={() => setShowAddModal(false)}
                                            className="flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg font-bold hover:bg-gray-300 cursor-pointer active:scale-95 transition-transform"
                                        >
                                            ุฅูุบุงุก
                                        </button>
                                        <button
                                            onClick={addTransaction}
                                            className="flex-1 py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 cursor-pointer active:scale-95 transition-transform"
                                        >
                                            ุฅุถุงูุฉ
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Render app and initialize icons
        const root = ReactDOM.createRoot(document.getElementById('app'));
        root.render(<DebtTrackerApp />);
        
        // Initialize Lucide icons
        setTimeout(() => {
            lucide.createIcons();
        }, 100);
        
        // Re-initialize icons when content changes
        setInterval(() => {
            lucide.createIcons();
        }, 500);
    </script>
</body>
</html>